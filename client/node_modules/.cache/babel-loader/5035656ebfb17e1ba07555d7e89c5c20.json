{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Popover = exports.usePopover = exports.ArrowContainer = exports.useArrowContainer = void 0;\n\nvar jsx_runtime_1 = require(\"react/jsx-runtime\");\n\nvar react_1 = require(\"react\");\n\nvar PopoverPortal_1 = require(\"./PopoverPortal\");\n\nvar util_1 = require(\"./util\");\n\nvar usePopover_1 = require(\"./usePopover\");\n\nObject.defineProperty(exports, \"usePopover\", {\n  enumerable: true,\n  get: function () {\n    return usePopover_1.usePopover;\n  }\n});\n\nvar useMemoizedArray_1 = require(\"./useMemoizedArray\");\n\nvar useArrowContainer_1 = require(\"./useArrowContainer\");\n\nObject.defineProperty(exports, \"useArrowContainer\", {\n  enumerable: true,\n  get: function () {\n    return useArrowContainer_1.useArrowContainer;\n  }\n});\n\nvar ArrowContainer_1 = require(\"./ArrowContainer\");\n\nObject.defineProperty(exports, \"ArrowContainer\", {\n  enumerable: true,\n  get: function () {\n    return ArrowContainer_1.ArrowContainer;\n  }\n});\nvar PopoverInternal = react_1.forwardRef(function (_a, externalRef) {\n  var isOpen = _a.isOpen,\n      children = _a.children,\n      content = _a.content,\n      _b = _a.positions,\n      externalPositions = _b === void 0 ? util_1.Constants.DEFAULT_POSITIONS : _b,\n      _c = _a.align,\n      align = _c === void 0 ? util_1.Constants.DEFAULT_ALIGN : _c,\n      _d = _a.padding,\n      padding = _d === void 0 ? 0 : _d,\n      _e = _a.reposition,\n      reposition = _e === void 0 ? true : _e,\n      _f = _a.parentElement,\n      parentElement = _f === void 0 ? window.document.body : _f,\n      _g = _a.boundaryElement,\n      boundaryElement = _g === void 0 ? parentElement : _g,\n      _h = _a.containerClassName,\n      containerClassName = _h === void 0 ? 'react-tiny-popover-container' : _h,\n      containerStyle = _a.containerStyle,\n      contentLocation = _a.contentLocation,\n      _j = _a.boundaryInset,\n      boundaryInset = _j === void 0 ? 0 : _j,\n      onClickOutside = _a.onClickOutside;\n  var positions = useMemoizedArray_1.useMemoizedArray(externalPositions); // TODO: factor prevs out into a custom prevs hook\n\n  var prevIsOpen = react_1.useRef(false);\n  var prevPositions = react_1.useRef();\n  var prevContentLocation = react_1.useRef();\n  var prevReposition = react_1.useRef(reposition);\n  var childRef = react_1.useRef();\n\n  var _k = react_1.useState({\n    align: align,\n    nudgedLeft: 0,\n    nudgedTop: 0,\n    position: positions[0],\n    padding: padding,\n    childRect: util_1.Constants.EMPTY_CLIENT_RECT,\n    popoverRect: util_1.Constants.EMPTY_CLIENT_RECT,\n    parentRect: util_1.Constants.EMPTY_CLIENT_RECT,\n    boundaryRect: util_1.Constants.EMPTY_CLIENT_RECT,\n    boundaryInset: boundaryInset\n  }),\n      popoverState = _k[0],\n      setPopoverState = _k[1];\n\n  var onPositionPopover = react_1.useCallback(function (popoverState) {\n    return setPopoverState(popoverState);\n  }, []);\n\n  var _l = usePopover_1.usePopover({\n    childRef: childRef,\n    containerClassName: containerClassName,\n    parentElement: parentElement,\n    boundaryElement: boundaryElement,\n    contentLocation: contentLocation,\n    positions: positions,\n    align: align,\n    padding: padding,\n    boundaryInset: boundaryInset,\n    reposition: reposition,\n    onPositionPopover: onPositionPopover\n  }),\n      positionPopover = _l.positionPopover,\n      popoverRef = _l.popoverRef,\n      scoutRef = _l.scoutRef;\n\n  react_1.useLayoutEffect(function () {\n    var shouldUpdate = true;\n\n    var updatePopover = function () {\n      var _a, _b;\n\n      if (isOpen && shouldUpdate) {\n        var childRect = (_a = childRef === null || childRef === void 0 ? void 0 : childRef.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();\n        var popoverRect = (_b = popoverRef === null || popoverRef === void 0 ? void 0 : popoverRef.current) === null || _b === void 0 ? void 0 : _b.getBoundingClientRect();\n\n        if (childRect != null && popoverRect != null && (!util_1.rectsAreEqual(childRect, {\n          top: popoverState.childRect.top,\n          left: popoverState.childRect.left,\n          width: popoverState.childRect.width,\n          height: popoverState.childRect.height,\n          bottom: popoverState.childRect.top + popoverState.childRect.height,\n          right: popoverState.childRect.left + popoverState.childRect.width\n        }) || popoverRect.width !== popoverState.popoverRect.width || popoverRect.height !== popoverState.popoverRect.height || popoverState.padding !== padding || popoverState.align !== align || positions !== prevPositions.current || contentLocation !== prevContentLocation.current || reposition !== prevReposition.current)) {\n          positionPopover();\n        } // TODO: factor prev checks out into the custom prevs hook\n\n\n        if (positions !== prevPositions.current) {\n          prevPositions.current = positions;\n        }\n\n        if (contentLocation !== prevContentLocation.current) {\n          prevContentLocation.current = contentLocation;\n        }\n\n        if (reposition !== prevReposition.current) {\n          prevReposition.current = reposition;\n        }\n\n        if (shouldUpdate) {\n          window.requestAnimationFrame(updatePopover);\n        }\n      }\n\n      prevIsOpen.current = isOpen;\n    };\n\n    window.requestAnimationFrame(updatePopover);\n    return function () {\n      shouldUpdate = false;\n    };\n  }, [align, contentLocation, isOpen, padding, popoverRef, popoverState.align, popoverState.childRect.height, popoverState.childRect.left, popoverState.childRect.top, popoverState.childRect.width, popoverState.padding, popoverState.popoverRect.height, popoverState.popoverRect.width, positionPopover, positions, reposition]);\n  react_1.useEffect(function () {\n    var popoverElement = popoverRef.current;\n    Object.assign(popoverElement.style, containerStyle);\n    return function () {\n      Object.keys(containerStyle !== null && containerStyle !== void 0 ? containerStyle : {}).forEach(function (key) {\n        return delete popoverElement.style[key];\n      });\n    };\n  }, [containerStyle, isOpen, popoverRef]);\n  var handleOnClickOutside = react_1.useCallback(function (e) {\n    var _a, _b;\n\n    if (isOpen && !((_a = popoverRef.current) === null || _a === void 0 ? void 0 : _a.contains(e.target)) && !((_b = childRef.current) === null || _b === void 0 ? void 0 : _b.contains(e.target))) {\n      onClickOutside === null || onClickOutside === void 0 ? void 0 : onClickOutside(e);\n    }\n  }, [isOpen, onClickOutside, popoverRef]);\n  var handleWindowResize = react_1.useCallback(function () {\n    if (childRef.current) {\n      window.requestAnimationFrame(function () {\n        return positionPopover();\n      });\n    }\n  }, [positionPopover]);\n  react_1.useEffect(function () {\n    window.addEventListener('click', handleOnClickOutside);\n    window.addEventListener('resize', handleWindowResize);\n    return function () {\n      window.removeEventListener('click', handleOnClickOutside);\n      window.removeEventListener('resize', handleWindowResize);\n    };\n  }, [handleOnClickOutside, handleWindowResize]);\n  var handleRef = react_1.useCallback(function (node) {\n    childRef.current = node;\n\n    if (externalRef != null) {\n      if (typeof externalRef === 'object') {\n        externalRef.current = node;\n      } else if (typeof externalRef === 'function') {\n        externalRef(node);\n      }\n    }\n  }, [externalRef]);\n\n  var renderChild = function () {\n    return react_1.cloneElement(children, {\n      ref: handleRef\n    });\n  };\n\n  var renderPopover = function () {\n    if (!isOpen) return null;\n    return jsx_runtime_1.jsx(PopoverPortal_1.PopoverPortal, __assign({\n      element: popoverRef.current,\n      scoutElement: scoutRef.current,\n      container: parentElement\n    }, {\n      children: typeof content === 'function' ? content(popoverState) : content\n    }), void 0);\n  };\n\n  return jsx_runtime_1.jsxs(jsx_runtime_1.Fragment, {\n    children: [renderChild(), renderPopover()]\n  }, void 0);\n});\nexports.Popover = react_1.forwardRef(function (props, ref) {\n  if (typeof window === 'undefined') return props.children;\n  return jsx_runtime_1.jsx(PopoverInternal, __assign({}, props, {\n    ref: ref\n  }), void 0);\n});","map":{"version":3,"mappings":"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","names":["Object","enumerable","get","usePopover_1","PopoverInternal","react_1","_a","externalRef","isOpen","children","content","_b","externalPositions","util_1","DEFAULT_POSITIONS","_c","align","DEFAULT_ALIGN","_d","padding","_e","reposition","_f","parentElement","window","document","body","_g","boundaryElement","_h","containerClassName","containerStyle","contentLocation","_j","boundaryInset","onClickOutside","positions","useMemoizedArray_1","prevIsOpen","prevPositions","prevContentLocation","prevReposition","childRef","nudgedLeft","nudgedTop","position","childRect","EMPTY_CLIENT_RECT","popoverRect","parentRect","boundaryRect","popoverState","setPopoverState","onPositionPopover","positionPopover","popoverRef","scoutRef","shouldUpdate","updatePopover","current","getBoundingClientRect","top","left","width","height","bottom","right","requestAnimationFrame","popoverElement","assign","style","keys","forEach","key","handleOnClickOutside","e","contains","target","handleWindowResize","addEventListener","removeEventListener","handleRef","node","renderChild","ref","renderPopover","jsx_runtime_1","PopoverPortal_1","__assign","element","scoutElement","container","exports","props"],"sources":["C:\\Users\\ewart\\OneDrive\\Documents\\GitHub\\flightpub\\client\\node_modules\\react-tiny-popover\\src\\Popover.tsx"],"sourcesContent":["import {\n  useRef,\n  useLayoutEffect,\n  useState,\n  useCallback,\n  useEffect,\n  forwardRef,\n  cloneElement,\n} from 'react';\nimport { PopoverPortal } from './PopoverPortal';\nimport {\n  ContentLocation,\n  ContentLocationGetter,\n  PopoverPosition,\n  PopoverProps,\n  PopoverState,\n} from '.';\nimport { Constants, rectsAreEqual } from './util';\nimport { usePopover } from './usePopover';\nimport { useMemoizedArray } from './useMemoizedArray';\n\nexport { useArrowContainer } from './useArrowContainer';\nexport { ArrowContainer } from './ArrowContainer';\nexport { usePopover };\n\nconst PopoverInternal = forwardRef<HTMLElement, PopoverProps>(\n  (\n    {\n      isOpen,\n      children,\n      content,\n      positions: externalPositions = Constants.DEFAULT_POSITIONS,\n      align = Constants.DEFAULT_ALIGN,\n      padding = 0,\n      reposition = true,\n      parentElement = window.document.body,\n      boundaryElement = parentElement,\n      containerClassName = 'react-tiny-popover-container',\n      containerStyle,\n      contentLocation,\n      boundaryInset = 0,\n      onClickOutside,\n    },\n    externalRef,\n  ) => {\n    const positions = useMemoizedArray(externalPositions);\n\n    // TODO: factor prevs out into a custom prevs hook\n    const prevIsOpen = useRef(false);\n    const prevPositions = useRef<PopoverPosition[] | undefined>();\n    const prevContentLocation = useRef<ContentLocation | ContentLocationGetter | undefined>();\n    const prevReposition = useRef(reposition);\n\n    const childRef = useRef<HTMLElement | undefined>();\n\n    const [popoverState, setPopoverState] = useState<PopoverState>({\n      align,\n      nudgedLeft: 0,\n      nudgedTop: 0,\n      position: positions[0],\n      padding,\n      childRect: Constants.EMPTY_CLIENT_RECT,\n      popoverRect: Constants.EMPTY_CLIENT_RECT,\n      parentRect: Constants.EMPTY_CLIENT_RECT,\n      boundaryRect: Constants.EMPTY_CLIENT_RECT,\n      boundaryInset,\n    });\n\n    const onPositionPopover = useCallback(\n      (popoverState: PopoverState) => setPopoverState(popoverState),\n      [],\n    );\n\n    const { positionPopover, popoverRef, scoutRef } = usePopover({\n      childRef,\n      containerClassName,\n      parentElement,\n      boundaryElement,\n      contentLocation,\n      positions,\n      align,\n      padding,\n      boundaryInset,\n      reposition,\n      onPositionPopover,\n    });\n\n    useLayoutEffect(() => {\n      let shouldUpdate = true;\n      const updatePopover = () => {\n        if (isOpen && shouldUpdate) {\n          const childRect = childRef?.current?.getBoundingClientRect();\n          const popoverRect = popoverRef?.current?.getBoundingClientRect();\n          if (\n            childRect != null &&\n            popoverRect != null &&\n            (!rectsAreEqual(childRect, {\n              top: popoverState.childRect.top,\n              left: popoverState.childRect.left,\n              width: popoverState.childRect.width,\n              height: popoverState.childRect.height,\n              bottom: popoverState.childRect.top + popoverState.childRect.height,\n              right: popoverState.childRect.left + popoverState.childRect.width,\n            }) ||\n              popoverRect.width !== popoverState.popoverRect.width ||\n              popoverRect.height !== popoverState.popoverRect.height ||\n              popoverState.padding !== padding ||\n              popoverState.align !== align ||\n              positions !== prevPositions.current ||\n              contentLocation !== prevContentLocation.current ||\n              reposition !== prevReposition.current)\n          ) {\n            positionPopover();\n          }\n\n          // TODO: factor prev checks out into the custom prevs hook\n          if (positions !== prevPositions.current) {\n            prevPositions.current = positions;\n          }\n          if (contentLocation !== prevContentLocation.current) {\n            prevContentLocation.current = contentLocation;\n          }\n          if (reposition !== prevReposition.current) {\n            prevReposition.current = reposition;\n          }\n\n          if (shouldUpdate) {\n            window.requestAnimationFrame(updatePopover);\n          }\n        }\n\n        prevIsOpen.current = isOpen;\n      };\n\n      window.requestAnimationFrame(updatePopover);\n\n      return () => {\n        shouldUpdate = false;\n      };\n    }, [\n      align,\n      contentLocation,\n      isOpen,\n      padding,\n      popoverRef,\n      popoverState.align,\n      popoverState.childRect.height,\n      popoverState.childRect.left,\n      popoverState.childRect.top,\n      popoverState.childRect.width,\n      popoverState.padding,\n      popoverState.popoverRect.height,\n      popoverState.popoverRect.width,\n      positionPopover,\n      positions,\n      reposition,\n    ]);\n\n    useEffect(() => {\n      const popoverElement = popoverRef.current;\n\n      Object.assign(popoverElement.style, containerStyle);\n\n      return () => {\n        Object.keys(containerStyle ?? {}).forEach(\n          (key) =>\n            delete popoverElement.style[\n              key as keyof Omit<typeof containerStyle, 'length' | 'parentRule'>\n            ],\n        );\n      };\n    }, [containerStyle, isOpen, popoverRef]);\n\n    const handleOnClickOutside = useCallback(\n      (e: MouseEvent) => {\n        if (\n          isOpen &&\n          !popoverRef.current?.contains(e.target as Node) &&\n          !childRef.current?.contains(e.target as Node)\n        ) {\n          onClickOutside?.(e);\n        }\n      },\n      [isOpen, onClickOutside, popoverRef],\n    );\n\n    const handleWindowResize = useCallback(() => {\n      if (childRef.current) {\n        window.requestAnimationFrame(() => positionPopover());\n      }\n    }, [positionPopover]);\n\n    useEffect(() => {\n      window.addEventListener('click', handleOnClickOutside);\n      window.addEventListener('resize', handleWindowResize);\n      return () => {\n        window.removeEventListener('click', handleOnClickOutside);\n        window.removeEventListener('resize', handleWindowResize);\n      };\n    }, [handleOnClickOutside, handleWindowResize]);\n\n    const handleRef = useCallback(\n      (node: HTMLElement) => {\n        childRef.current = node;\n        if (externalRef != null) {\n          if (typeof externalRef === 'object') {\n            (externalRef as React.MutableRefObject<HTMLElement>).current = node;\n          } else if (typeof externalRef === 'function') {\n            (externalRef as (instance: HTMLElement) => void)(node);\n          }\n        }\n      },\n      [externalRef],\n    );\n\n    const renderChild = () =>\n      cloneElement(children as JSX.Element, {\n        ref: handleRef,\n      });\n\n    const renderPopover = () => {\n      if (!isOpen) return null;\n      return (\n        <PopoverPortal\n          element={popoverRef.current}\n          scoutElement={scoutRef.current}\n          container={parentElement}\n        >\n          {typeof content === 'function' ? content(popoverState) : content}\n        </PopoverPortal>\n      );\n    };\n\n    return (\n      <>\n        {renderChild()}\n        {renderPopover()}\n      </>\n    );\n  },\n);\n\nexport const Popover = forwardRef<HTMLElement, PopoverProps>((props, ref) => {\n  if (typeof window === 'undefined') return props.children;\n  return <PopoverInternal {...props} ref={ref} />;\n});\n"]},"metadata":{},"sourceType":"script"}